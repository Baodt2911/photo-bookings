<!DOCTYPE html>
<html
  lang="vi"
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{admin/layout/admin-layout}"
>
  <head>
    <title>Quản lý Album - Admin</title>
    <link th:href="@{/css/tailwind.css}" rel="stylesheet" />
    <script src="/js/admin/my-album-management.js"></script>
  </head>
  <body>
    <div layout:fragment="content">
      <!-- Page Header -->
      <div class="mb-6">
        <div class="flex items-center justify-between">
          <div>
            <h1 class="text-2xl font-bold text-gray-900">My Albums</h1>
            <p class="text-gray-600 mt-2">
              Quản lý album ảnh cá nhân của admin
            </p>
          </div>
          <div class="flex space-x-3">
            <button
              onclick="openMyAlbumModal()"
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center space-x-2 transition-colors"
            >
              <i class="fas fa-plus"></i>
              <span>Tạo Album</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Tổng Albums</p>
              <p
                class="text-2xl font-bold text-gray-900"
                th:text="${totalMyAlbums ?: 0}"
              >
                15
              </p>
            </div>
            <div
              class="h-12 w-12 bg-purple-100 rounded-lg flex items-center justify-center"
            >
              <i class="fas fa-images text-purple-600"></i>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Tổng Ảnh</p>
              <p
                class="text-2xl font-bold text-gray-900"
                th:text="${totalMyPhotos ?: 0}"
              >
                1,247
              </p>
            </div>
            <div
              class="h-12 w-12 bg-blue-100 rounded-lg flex items-center justify-center"
            >
              <i class="fas fa-image text-blue-600"></i>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Albums Công Khai</p>
              <p
                class="text-2xl font-bold text-gray-900"
                th:text="${publicMyAlbums ?: 0}"
              >
                8
              </p>
            </div>
            <div
              class="h-12 w-12 bg-green-100 rounded-lg flex items-center justify-center"
            >
              <i class="fas fa-globe text-green-600"></i>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-xl shadow-sm p-6 border border-gray-100">
          <div class="flex items-center justify-between">
            <div>
              <p class="text-sm font-medium text-gray-600">Ảnh Yêu Thích</p>
              <p
                class="text-2xl font-bold text-gray-900"
                th:text="${favoritePhotos ?: 0}"
              >
                89
              </p>
            </div>
            <div
              class="h-12 w-12 bg-red-100 rounded-lg flex items-center justify-center"
            >
              <i class="fas fa-heart text-red-600"></i>
            </div>
          </div>
        </div>
      </div>

      <!-- Search and Filter Form -->
      <div
        class="bg-white rounded-xl shadow-sm p-6 mb-6 border border-gray-100"
      >
        <form
          method="GET"
          action="/admin/my-albums"
          class="flex flex-wrap items-center gap-4"
        >
          <div class="flex-1 min-w-64">
            <input
              type="text"
              name="search"
              placeholder="Tìm kiếm album..."
              th:value="${param.search}"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
            />
          </div>
          <select
            name="isPublic"
            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <option value="">Tất cả trạng thái</option>
            <option value="true" th:selected="${param.isPublic == 'true'}">
              Công khai
            </option>
            <option value="false" th:selected="${param.isPublic == 'false'}">
              Riêng tư
            </option>
          </select>
          <select
            name="sort"
            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
          >
            <option value="name" th:selected="${param.sort == 'name'}">
              Tên A-Z
            </option>
            <option
              value="name_desc"
              th:selected="${param.sort == 'name_desc'}"
            >
              Tên Z-A
            </option>
            <option
              value="created_at_desc"
              th:selected="${param.sort == 'created_at_desc'}"
            >
              Mới nhất
            </option>
            <option
              value="created_at"
              th:selected="${param.sort == 'created_at'}"
            >
              Cũ nhất
            </option>
          </select>
          <a
            href="/admin/my-albums"
            class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
          >
            <i class="fas fa-times mr-2"></i>Xóa bộ lọc
          </a>
        </form>
      </div>

      <!-- Albums Grid -->
      <div
        class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6"
      >
        <div
          th:each="album : ${myAlbums.content}"
          class="bg-white rounded-xl shadow-sm border border-gray-100 overflow-hidden hover:shadow-md transition-all duration-300 group cursor-pointer"
        >
          <div class="relative">
            <div
              class="h-48 bg-gradient-to-br from-blue-100 to-blue-200 relative overflow-hidden"
            >
              <img
                th:if="${myAlbumService.getCoverPhotoUrl(album) != null}"
                th:src="${myAlbumService.getCoverPhotoUrl(album)}"
                th:alt="${album.name}"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
              />

              <div class="absolute top-3 right-3">
                <span
                  class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-medium"
                >
                  <i
                    th:class="${album.isPublic ? 'fas fa-globe' : 'fas fa-lock'}"
                    class="mr-1"
                  ></i>
                  <span th:text="${album.isPublic ? 'Công khai' : 'Riêng tư'}"
                    >Công khai</span
                  >
                </span>
              </div>

              <div class="absolute bottom-3 left-3">
                <div
                  class="bg-black bg-opacity-50 text-white px-2 py-1 rounded-lg text-xs"
                >
                  <i class="fas fa-image mr-1"></i>
                  <span
                    th:text="${album.myPhotos != null ? album.myPhotos.size() + ' ảnh' : '0 ảnh'}"
                    >32 ảnh</span
                  >
                </div>
              </div>

              <div
                class="absolute top-3 left-3 opacity-0 group-hover:opacity-100 transition-opacity"
              >
                <div class="flex space-x-1">
                  <button
                    th:data-album-id="${album.id}"
                    onclick="shareMyAlbum(this.dataset.albumId)"
                    class="w-8 h-8 bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full flex items-center justify-center text-red-600 transition-colors"
                  >
                    <i class="fas fa-heart text-xs"></i>
                  </button>
                  <button
                    th:data-album-id="${album.id}"
                    onclick="shareMyAlbum(this.dataset.albumId)"
                    class="w-8 h-8 bg-white bg-opacity-90 hover:bg-opacity-100 rounded-full flex items-center justify-center text-gray-600 hover:text-blue-600 transition-colors"
                  >
                    <i class="fas fa-share text-xs"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="p-4">
              <h3 class="font-semibold text-gray-900 mb-1">
                <span th:text="${album.name}">Nature Photography</span>
              </h3>
              <p class="text-sm text-gray-500 mb-3">
                <span th:text="${album.description}"
                  >Bộ sưu tập ảnh thiên nhiên hoặc các địa điểm đẹp từ khắp nơi
                  trên thế giới.</span
                >
              </p>

              <div
                class="flex items-center justify-between text-xs text-gray-500"
              >
                <span
                  th:text="${#temporals.format(album.createdAt, 'dd/MM/yyyy')}"
                  >10/12/2024</span
                >
                <div class="flex space-x-2">
                  <button
                    th:data-album-id="${album.id}"
                    onclick="editMyAlbum(this.dataset.albumId)"
                    class="hover:text-blue-600 transition-colors"
                  >
                    <i class="fas fa-edit"></i>
                  </button>
                  <button
                    th:data-album-id="${album.id}"
                    onclick="shareMyAlbum(this.dataset.albumId)"
                    class="hover:text-green-600 transition-colors"
                  >
                    <i class="fas fa-share-alt"></i>
                  </button>
                  <button
                    th:data-album-id="${album.id}"
                    onclick="deleteMyAlbum(this.dataset.albumId)"
                    class="hover:text-red-600 transition-colors"
                  >
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Pagination -->
      <div
        class="bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6"
      >
        <div class="flex-1 flex justify-between sm:hidden">
          <!-- Mobile Previous -->
          <a
            th:if="${myAlbums.hasPrevious()}"
            th:href="@{/admin/my-albums(search=${param.search}, isPublic=${param.isPublic}, sort=${param.sort}, page=${myAlbums.number})}"
            class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
          >
            <i class="fas fa-chevron-left mr-1"></i>Trước
          </a>
          <span
            th:unless="${myAlbums.hasPrevious()}"
            class="relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-400 bg-gray-100 cursor-not-allowed"
          >
            <i class="fas fa-chevron-left mr-1"></i>Trước
          </span>

          <!-- Mobile Page Info -->
          <span class="text-sm text-gray-700 self-center">
            Trang
            <span class="font-medium" th:text="${myAlbums.number + 1}">1</span>
            /
            <span class="font-medium" th:text="${myAlbums.totalPages}">1</span>
          </span>

          <!-- Mobile Next -->
          <a
            th:if="${myAlbums.hasNext()}"
            th:href="@{/admin/my-albums(search=${param.search}, isPublic=${param.isPublic}, sort=${param.sort}, page=${myAlbums.number + 2})}"
            class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50"
          >
            Sau<i class="fas fa-chevron-right ml-1"></i>
          </a>
          <span
            th:unless="${myAlbums.hasNext()}"
            class="ml-3 relative inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-400 bg-gray-100 cursor-not-allowed"
          >
            Sau<i class="fas fa-chevron-right ml-1"></i>
          </span>
        </div>

        <div
          class="hidden sm:flex-1 sm:flex sm:items-center sm:justify-between"
        >
          <div>
            <p class="text-sm text-gray-700">
              Hiển thị
              <span
                class="font-medium"
                th:text="${myAlbums.number * myAlbums.size + 1}"
                >1</span
              >
              đến
              <span
                class="font-medium"
                th:text="${myAlbums.number * myAlbums.size + myAlbums.numberOfElements}"
                >10</span
              >
              của
              <span class="font-medium" th:text="${myAlbums.totalElements}"
                >0</span
              >
              kết quả
            </p>
          </div>
          <div>
            <nav
              class="relative z-0 inline-flex rounded-md shadow-sm -space-x-px"
            >
              <!-- Previous Button -->
              <a
                th:if="${myAlbums.hasPrevious()}"
                th:href="@{/admin/my-albums(search=${param.search}, isPublic=${param.isPublic}, sort=${param.sort}, page=${myAlbums.number})}"
                class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
              >
                <i class="fas fa-chevron-left"></i>
              </a>
              <span
                th:unless="${myAlbums.hasPrevious()}"
                class="relative inline-flex items-center px-2 py-2 rounded-l-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed"
              >
                <i class="fas fa-chevron-left"></i>
              </span>

              <!-- Page Numbers -->
              <th:block
                th:each="pageNum : ${#numbers.sequence(0, myAlbums.totalPages - 1)}"
              >
                <a
                  th:if="${pageNum != myAlbums.number}"
                  th:href="@{/admin/my-albums(search=${param.search}, isPublic=${param.isPublic}, sort=${param.sort}, page=${pageNum + 1})}"
                  class="relative inline-flex items-center px-4 py-2 border border-gray-300 bg-white text-sm font-medium text-gray-700 hover:bg-gray-50"
                  th:text="${pageNum + 1}"
                  >1</a
                >
                <span
                  th:if="${pageNum == myAlbums.number}"
                  class="relative inline-flex items-center px-4 py-2 border border-blue-500 bg-blue-50 text-sm font-medium text-blue-600"
                  th:text="${pageNum + 1}"
                  >1</span
                >
              </th:block>

              <!-- Next Button -->
              <a
                th:if="${myAlbums.hasNext()}"
                th:href="@{/admin/my-albums(search=${param.search}, isPublic=${param.isPublic}, sort=${param.sort}, page=${myAlbums.number + 2})}"
                class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-white text-sm font-medium text-gray-500 hover:bg-gray-50"
              >
                <i class="fas fa-chevron-right"></i>
              </a>
              <span
                th:unless="${myAlbums.hasNext()}"
                class="relative inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 bg-gray-100 text-sm font-medium text-gray-400 cursor-not-allowed"
              >
                <i class="fas fa-chevron-right"></i>
              </span>
            </nav>
          </div>
        </div>
      </div>
      <!-- My Album Modal -->
      <div
        id="myAlbumModal"
        class="fixed inset-0 overflow-y-auto h-full w-full hidden z-50"
        style="background-color: rgba(0, 0, 0, 0.3)"
      >
        <div
          class="relative top-10 mx-auto p-5 w-full max-w-4xl shadow-2xl rounded-xl bg-white"
        >
          <div class="flex justify-between items-center mb-6">
            <h3
              id="myAlbumModalTitle"
              class="text-lg font-semibold text-gray-900"
            >
              Tạo Album mới
            </h3>
            <button
              onclick="closeMyAlbumModal()"
              class="text-gray-400 hover:text-gray-600 transition-colors"
            >
              <i class="fas fa-times text-xl"></i>
            </button>
          </div>

          <!-- Progress Steps -->
          <div class="mb-8">
            <div class="flex items-center justify-center space-x-4">
              <div class="flex items-center">
                <div
                  id="step1Indicator"
                  class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-sm font-medium"
                >
                  1
                </div>
                <span class="ml-2 text-sm font-medium text-gray-900"
                  >Thông tin Album</span
                >
              </div>
              <div class="w-16 h-0.5 bg-gray-300"></div>
              <div class="flex items-center">
                <div
                  id="step2Indicator"
                  class="w-8 h-8 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center text-sm font-medium"
                >
                  2
                </div>
                <span class="ml-2 text-sm font-medium text-gray-500"
                  >Upload Ảnh</span
                >
              </div>
            </div>
          </div>

          <form id="myAlbumForm" enctype="multipart/form-data">
            <input type="hidden" id="myAlbumId" name="id" />
            <input type="hidden" id="isEditMode" value="false" />

            <!-- Step 1: Album Information -->
            <div id="step1" class="step-content">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Album Name -->
                <div class="md:col-span-2">
                  <label
                    for="myAlbumName"
                    class="block text-sm font-medium text-gray-700 mb-2"
                  >
                    Tên Album *
                  </label>
                  <input
                    type="text"
                    id="myAlbumName"
                    name="name"
                    required
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                    placeholder="Nhập tên album"
                  />
                </div>

                <!-- Description -->
                <div class="md:col-span-2">
                  <label
                    for="myAlbumDescription"
                    class="block text-sm font-medium text-gray-700 mb-2"
                  >
                    Mô tả
                  </label>
                  <textarea
                    id="myAlbumDescription"
                    name="description"
                    rows="3"
                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none"
                    placeholder="Nhập mô tả album..."
                  ></textarea>
                </div>

                <!-- Is Public -->
                <div class="flex items-center">
                  <input type="hidden" name="isPublic" value="false" />
                  <input
                    type="checkbox"
                    id="myAlbumIsPublic"
                    name="isPublic"
                    value="true"
                    class="h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500"
                  />
                  <label
                    for="myAlbumIsPublic"
                    class="ml-3 text-sm font-medium text-gray-700"
                  >
                    Album công khai
                  </label>
                </div>
              </div>

              <!-- Step 1 Actions -->
              <div class="flex justify-end space-x-3 mt-6 pt-6 border-t">
                <button
                  type="button"
                  onclick="closeMyAlbumModal()"
                  class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                >
                  Hủy
                </button>
                <button
                  type="button"
                  onclick="nextStep()"
                  class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                >
                  Tiếp theo
                </button>
              </div>
            </div>

            <!-- Step 2: Upload Images -->
            <div id="step2" class="step-content hidden">
              <div class="mb-6">
                <h4 class="text-lg font-medium text-gray-900 mb-4">
                  Upload Ảnh cho Album
                </h4>

                <!-- File Upload Area -->
                <div
                  class="border-2 border-dashed border-gray-300 rounded-lg p-8 text-center hover:border-gray-400 transition-colors"
                >
                  <input
                    type="file"
                    id="imageUpload"
                    name="images"
                    multiple
                    accept="image/*"
                    class="hidden"
                    onchange="handleImageUpload(event)"
                  />
                  <label for="imageUpload" class="cursor-pointer">
                    <i
                      class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"
                    ></i>
                    <p class="text-lg font-medium text-gray-700 mb-2">
                      Kéo thả ảnh vào đây hoặc click để chọn
                    </p>
                    <p class="text-sm text-gray-500">
                      Hỗ trợ: JPG, PNG, GIF (Tối đa 10MB mỗi ảnh)
                    </p>
                  </label>
                </div>
              </div>

              <!-- Image Grid -->
              <div
                id="imageGrid"
                class="columns-2 md:columns-3 lg:columns-4 gap-4 mb-6"
              >
                <!-- Images will be dynamically added here -->
              </div>

              <!-- Cover Photo Info -->
              <div id="coverPhotoInfo" class="hidden mb-6">
                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                  <p class="text-sm text-blue-800">
                    <i class="fas fa-info-circle mr-2"></i>
                    Click vào ảnh để chọn làm ảnh bìa. Ảnh được chọn sẽ có viền
                    xanh.
                  </p>
                </div>
              </div>

              <!-- Step 2 Actions -->
              <div class="flex justify-between space-x-3 pt-6 border-t">
                <button
                  type="button"
                  onclick="prevStep()"
                  class="px-6 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition-colors"
                >
                  Quay lại
                </button>
                <div class="flex space-x-3">
                  <button
                    type="button"
                    onclick="closeMyAlbumModal()"
                    class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition-colors"
                  >
                    Hủy
                  </button>
                  <button
                    type="submit"
                    class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
                  >
                    Tạo Album
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <!-- Delete Confirmation Modal -->
      <div
        id="confirmModal"
        class="fixed inset-0 overflow-y-auto h-full w-full hidden z-50"
        style="background-color: rgba(0, 0, 0, 0.3)"
      >
        <div
          class="relative top-20 mx-auto p-5 w-96 shadow-2xl rounded-xl bg-white"
        >
          <div class="mt-3 text-center">
            <div
              class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-red-100 mb-4"
            >
              <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
            </div>
            <h3 class="text-lg font-medium text-gray-900 mb-2">Xác nhận xóa</h3>
            <p id="confirmMessage" class="text-sm text-gray-500 mb-6">
              Bạn có chắc chắn muốn xóa album này? Hành động này không thể hoàn
              tác.
            </p>
            <div class="flex justify-center space-x-3">
              <button
                onclick="closeConfirmModal()"
                class="px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors"
              >
                Hủy
              </button>
              <button
                id="confirmDeleteBtn"
                onclick="confirmDelete()"
                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors"
              >
                Xóa
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
